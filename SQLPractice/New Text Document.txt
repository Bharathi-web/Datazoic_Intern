use SQLTraining;
go
CREATE schema EventManagement;
go

-- table 1 Organizers Table
create table EventManagement.Organizers(
OrganizerID int primary key identity(1,1),
Name varchar(25) not null,
Email nvarchar(40) unique,
Phone int,
CompanyName nvarchar(30)
);

select * from EventManagement.Organizers;
EXEC sp_columns 'EventManagemet.Organizers';


-- table 2 Venues Table
create table EventManagement.Venues(
VenuesId int primary Key identity(1,1),
VenueName nvarchar(50) not null,
VenueLocation nvarchar(50),
Capacity int,
FacilitiesAvailable nvarchar(300),
);
select * from EventManagement.Venues;


-- table 3 Events Table
create table EventManagement.Events(
EventId int primary key identity(1,1),
EventName nvarchar(40) not null,
EventType  nvarchar(40),
EventDate date,
EventStartTime time,
Category nvarchar(100),
AdditionalNeeds nvarchar(300),
OrganizerID int foreign key references EventManagement.Organizers(OrganizerID),
VenuesId int foreign key references EventManagement.Venues(VenuesId),
CreatedTime datetime default getdate(),
UpdatedTime datetime default getdate()
);
select * from EventManagement.Events;


--table 4 EventFacilities
create table EventManagement.EventFacilities(
FacilityId int primary key identity(1,1),
FacilityName nvarchar(300)
);
select * from EventManagement.EventFacilities;

-- table 5 Facilities Mapping
create table EventManagement.Facilities(
EventId int foreign key references EventManagement.Events(EventId),
FacilityId int foreign key references EventManagement.EventFacilities(FacilityId)
);

--table 6 Participants
create table EventManagement.Participants(
UserId int primary key identity(1,1),
Name nvarchar(20) not null,
Email nvarchar(30),
Phone int,
Role nvarchar(30)
);


-- table 7 Registrations
create table EventManagement.Registrations(
RegistrationId int primary key identity(1,1),
EventId int foreign key references EventManagement.Events(EventId),
UserId int foreign key references EventManagement.Participants(UserId),
TicketType nvarchar(30),
PaymentStatus nvarchar(30),
RegisterAt date default getdate()
);


-- table 8 Sponsers
create table EventManagement.Sponsers(
SponserId int primary key identity(1,1),
Name varchar(20),
Email nvarchar(30),
Phone int,
Contribution decimal(12,2),
EventId int foreign key references EventManagement.Events(EventId)
);

-- table 9 Feedback
create table EventManagement.Feedback(
FeedbackId int primary key identity(1,1),
EventId int foreign key references EventManagement.Events(EventId),
UserId int foreign key references EventManagement.Participants(UserId),
Rating int check(Rating between 1 and 5),
Comments nvarchar(300)
);

EXEC sp_tables;

-- All Tables
SELECT
    t.name AS Table_Name
FROM
    sys.tables AS t
WHERE
    SCHEMA_NAME(t.schema_id) = 'EventManagement';


-- insert into Organizers
	--INSERT INTO SchemaName.TableName (Column1, Column2, ...) VALUES (Value1, Value2, ...);

go
insert into EventManagement.Organizers(Name,Email,Phone,CompanyName) values ('Bharathi', 'Bharathi@gmail.com', 8438933808, 'SVRT');

--Altering Table Datatype 
  --ALTER TABLE SchemaName.TableName ALTER COLUMN ColumnName NewDataType [NULL | NOT NULL];

alter table EventManagement.Organizers 
alter column Phone bigint;

insert into EventManagement.Organizers(Name,Email,Phone,CompanyName) values ('Yoga', 'yoga@gmail.com', 8438933798, 'EmptyOrg');
insert into EventManagement.Organizers(Name, Email, Phone, CompanyName) values
('Priya', 'priya@eventhub.com', 9123456780, 'EventHub'),
('Arun', 'arun@celebrateit.com', 9876543210, 'CelebrateIt'),
('Meena', 'meena@planitright.com', 9988776655, 'PlanItRight'),
('Karthik', 'karthik@eventify.com', 9090909090, 'Eventify'),
('Divya', 'divya@funzone.org', 8123456789, 'FunZone'),
('Ravi', 'ravi@organizeit.com', 8001234567, 'OrganizeIt'),
('Sneha', 'sneha@happeningevents.com', 8222334455, 'HappeningEvents'),
('Vijay', 'vijay@nextgenevents.com', 8444556677, 'NextGenEvents'),
('Lakshmi', 'lakshmi@eliteevents.com', 8555667788, 'EliteEvents');


-- Updating Values in a Table
update EventManagement.Organizers set Name='Ram' where OrganizerID=5;
delete EventManagement.Organizers where OrganizerID=13;

--Indexing on Organizer ID and phone
--CREATE NONCLUSTERED INDEX idx_employee_name ON HumanResources.Employees (FirstName ASC, LastName ASC);
create nonclustered index idx_Organizers on EventManagement.Organizers(OrganizerID, Phone);


-- insert into Venues

insert into EventManagement.Venues (VenueName,VenueLocation,Capacity,FacilitiesAvailable) values ('TVH Park', 'Chennai', 500,'Cleaning, Managing, Catering');
insert into EventManagement.Venues(VenueName,VenueLocation,Capacity,FacilitiesAvailable) values 
('SKCL Tech', 'Vellore', 1000, 'Order,Maintainance'),
('Krishnan Mahal', 'chennai',1000,'Order,Maintainance,Cleaning');

--update value
update EventManagement.Venues set FacilitiesAvailable='Orders,Foods,RoomFacility' where VenuesId=3;
insert into EventManagement.Venues (VenueName,VenueLocation,Capacity,FacilitiesAvailable) values ('TVH Park', 'Chennai', 500,'Cleaning, Managing, Catering');

--delete value
delete EventManagement.Venues where VenuesId=4;

--indexing
create nonclustered index idx_Venues on EventManagement.Venues(VenueName);


-- Describe table
SELECT
    COLUMN_NAME,
    DATA_TYPE,
    CHARACTER_MAXIMUM_LENGTH,
    IS_NULLABLE
FROM
    INFORMATION_SCHEMA.COLUMNS
WHERE
    TABLE_SCHEMA = 'EventManagement' AND TABLE_NAME = 'Organizers';


-- insert into Events
insert into EventManagement.Events(EventName